# Applying Text-to-SQL in Process Mining: Leveraging Natural Language for Data Insights

This repository includes the resources referenced in the paper, as well as complete results for metrics Exact Match Accuracy (EM) and Execution Accuracty (EX) for Portuguese and English language. Bellow the details of each resource:

- dataset: 
    - text2sql4pm.tsv: contains all data in tsv format file
    - gold_en.txt: contains the standard SQL statements for English language
    - gold_en.txt: contains the standard SQL statements for Portuguese language 

- results: evaluations of SQL statements generated by the models using OpenAI and Code representations with 0-shot and 1-shot prompt strategies. The results for both languages, English and Portuguese are available in their respective folders. Each strategy used are identified by the folder name and contains the same structure.
    - questions.json: contains the prompts to ask models to generate SQL statements
    - RESULTS_MODEL-gemini-1.0-pro.txt: SQL statements generated by Gemini-1.0 Pro model
    - RESULTS_MODEL-gpg-3.5-turbo.txt: SQL statements generated by GPT-3.5 Turbo model
    - RESULTS_MODEL-Meta-Llama-3-8B-Instruct.txt: SQL statements generated by Llama3-8B Instruct
    - evaluations:
        - scores_cr_gemini10_EM: evaluation results on Exact Match Accuracy metric of SQL statements generated by Gemini-1.0 Pro 
        - scores_cr_gemini10_EX: evaluation results on Execution Accuracy metric of SQL statements generated by Gemini-1.0 Pro 
        - scores_cr_gpt35_EM: evaluation results on Exact Match Accuracy metric of SQL statements generated by GPT-3.5 Turbo 
        - scores_cr_gpt35_EX: evaluation results on Execution Accuracy metric of SQL statements generated by GPT-3.5 Turbo 
        - scores_cr_llama3_EM: evaluation results on Exact Match Accuracy metric of SQL statements generated by Llama3-8B Instruct
        - scores_cr_llama3_EX: evaluation results on Execution Accuracy metric of SQL statements generated by Llama3-8B Instruct

- graphs_results: contains the graphs images for all SQL complexity results for each metric on both languages, Portuguese and English

- scripts:
    - main.py: the entry point for executing the results analysis based on the parameters provided
    - execute_analysis.py: the common pre-steps for executing results analysis for each SQL complexity
    - execution.py: steps and configurations necessary to process the results and generates the graphs for each SQL complexity
    - graphs_plot.py: function to generate the graphs results
    - loader_results.py: contains the class used to support the load of files results for each prompt strategy (0-shot and 1-shot) and prompt representation
    - sql_pattern.py: contains filters for SQL patterns template founded in each SQL complexity 
    - utils.py: auxiliary function to calculate results percentage
    - run.sh: shell script to process all results

## Complete results

This section contains the complete results of models evaluations using Exact Match Accuracy (EM) and Execution Accuracy (EX) metrics for both languages, English and Portuguese and details of each SQL pattern template founded within each SQL complexity class. 

### Metrics - Exact Match Accuracy (EM) and Execution Accuracy (EX)

<table>
  <tr>
    <th></th>
    <th></th>
    <th></th>
    <th colspan="2">GPT-3.5 Turbo</th>
    <th colspan="2">Gemini-1.0 Pro</th>
    <th colspan="2">Llama3-8B Instruct</th>
  </tr>
  <tr>
    <td></td>
    <td></td>
    <td></td>
    <td>OPR</td>
    <td>CR</td>
    <td>OPR</td>
    <td>CR</td>
    <td>OPR</td>
    <td>CR</td>
  </tr>
  <tr>
    <td>EM</td>
    <td>English</td>
    <td>0-shot</td>
    <td><b>25.50%</b></td>  
    <td>14.68%</td>
    <td>22.66%</td>
    <td>5.20%</td>
    <td>16.37%</td>
    <td>13.78%</td>
  </tr>
  <tr>
    <td></td>
    <td></td>
    <td>1-shot</td>
    <td>37.16%</td>  
    <td><b>40.12%</b></td>
    <td>24.89%</td>
    <td>28.04%</td>
    <td><b>40.12%</b></td>
    <td>24.95%</td>
  </tr>
   <tr>
    <td></td>
    <td>Portuguese</td>
    <td>0-shot</td>
    <td><b>24.77%</b></td>  
    <td>16.92%</td>
    <td>21.15%</td>
    <td>5.38%</td>
    <td>15.65%</td>
    <td>11.90%</td>
  </tr>
  <tr>
    <td></td>
    <td></td>
    <td>1-shot</td>
    <td>36.01%</td>  
    <td><b>38.01%</b></td>
    <td>23.99%</td>
    <td>27.67%</td>
    <td><b>38.01%</b></td>
    <td>19.03%</td>
  </tr>
  <tr>
    <td></td>
    <td></td>
    <td></td>
    <td></td>  
    <td></td>
    <td></td>
    <td></td>
    <td></td>
    <td></td>
  </tr>
  <tr>
    <td>EX</td>
    <td>English</td>
    <td>0-shot</td>
    <td><b>47.61%</b></td>  
    <td>46.47%</td>
    <td>39.70%</td>
    <td>37.52%</td>
    <td>36.13%</td>
    <td>39.09%</td>
  </tr>
  <tr>
    <td></td>
    <td></td>
    <td>1-shot</td>
    <td>47.85%</td>  
    <td><b>54.56%</b></td>
    <td>38.67</td>
    <td>47.73%</td>
    <td>39.40%</td>
    <td>47.79%</td>
  </tr>
  <tr>
    <td></td>
    <td>Portuguese</td>
    <td>0-shot</td>
    <td>44.53%</td>  
    <td><b>45.74%</b></td>
    <td>37.16%</td>
    <td>40.18%</td>
    <td>35.77%</td>
    <td>36.01%</td>
  </tr>
  <tr>
    <td></td>
    <td></td>
    <td>1-shot</td>
    <td>47.79%</b></td>  
    <td><b>52.63%</b></td>
    <td>42.66%</td>
    <td>49.49%</td>
    <td>35.29%</td>
    <td>43.50%</td>
  </tr>
</table>

### SQL patterns template

### Easy
|  Symbol   |                                           SQL Pattern                                                       |
|-----------|-------------------------------------------------------------------------------------------------------------|
| Sc        | SELECT *concept* FROM event\_log (ORDER BY *concept*<sup>+</sup>)<sup>*</sup>                              |
| ScFc      | SELECT *concept* FROM event\_log WHERE (FILTER *concept*) (ORDER BY *concept*<sup>+</sup>)<sup>*</sup>      | 
| ScGcFc<sup>+</sup>| SELECT *concept* FROM event\_log GROUP BY *concept* HAVING (FILTER *concept*)<sup>+</sup>              |
| Ac        | SELECT AGG(*concept*) FROM event\_log                                                                       |           
| AcFc      | SELECT AGG(*concept*) FROM event\_log (FILTER *concept*)                                                    |

**Exact Match Accuracy**

*English*
![My Image](graphs_results/results_easy_EM.png)

*Portuguese*
![My Image](graphs_results/results_easy_EM_pt.png)

**Execution Accuracy**

*English*
![My Image](graphs_results/results_easy_EX.png)

*Portuguese*
![My Image](graphs_results/results_easy_EX_pt.png)

### Medium
|  Symbol   |                                           SQL Pattern                                                       |
|-----------|-------------------------------------------------------------------------------------------------------------|
| Sc<sup>+</sup> | SELECT (*concept*<sup>+</sup>) from event\_log (ORDER BY *concept*)<sup>*</sup> |
| ScGc  | SELECT *concept* FROM event\_log GROUP BY *concept* ORDER BY *concept* |
| Sc<sup>+</sup>Fc<sup>+</sup>   | SELECT (*concept*<sup>+</sup>) FROM event\_log WHERE (FILTER *concept*)<sup>+</sup> (ORDER BY *concept*)<sup>*</sup> |
| Sc<sup>+</sup>GcFc<sup>+</sup> |  SELECT (*concept*<sup>+</sup>) FROM event\_log GROUP BY *concept* HAVING (FILTER *concept*)<sup>+</sup> |
| Acc<sup>+</sup>Gc | SELECT AGG(*concept*), (*concept*<sup>+</sup>) FROM event\_log GROUP BY *concept* |
| Ac(c<sup>+</sup>)<sup>* </sup>Fc<sup>+</sup>(Gc)<sup>*</sup> | SELECT AGG(*concept*), (*concept*<sup>+</sup>)<sup>* </sup> FROM event\_log WHERE (FILTER *concept*)<sup>+</sup>(GROUP BY *concept*)<sup>*</sup> |
| (Ac)<sup>+</sup>c(Fc)<sup>*</sup>GcFc | SELECT AGG(*concept*)<sup>+</sup>, *concept* FROM event\_log (WHERE FILTER *concept*)<sup>*</sup> GROUP BY *concept* HAVING (FILTER *concept*) |

**Exact Match Accuracy**

*English*
![My Image](graphs_results/results_medium_EM.png)

*Portuguese*
![My Image](graphs_results/results_medium_EM_pt.png)

**Execution Accuracy**

*English*
![My Image](graphs_results/results_medium_EX.png)

*Portuguese*
![My Image](graphs_results/results_medium_EX_pt.png)

### Hard
|  Symbol   |                                           SQL Pattern                                                       |
|-----------|-------------------------------------------------------------------------------------------------------------|
|  Sc<sup>+</sup>Fc<sup>+</sup>(Gc)<sup>*</sup> | SELECT (*concept*<sup>+</sup>) FROM event\_log WHERE (FILTER *concept*)<sup>+</sup> (GROUP BY concept)<sup>* </sup> (ORDER BY *concept*)<sup>*</sup> |
|  ScFSc  | SELECT *concept* FROM event\_log WHERE (FILTER *concept* SELECT) |
|  ScFcGcFc  | SELECT *concept* FROM event\_log WHERE (FILTER *concept*) GROUP BY *concept* HAVING (FILTER *concept*) |
|  ScGcFSc  | SELECT *concept* FROM event\_log GROUP BY *concept* HAVING (FILTER *concept* SELECT) |
|  AcFSc  | SELECT AGG(*concept*) FROM event\_log WHERE (FILTER *concept* SELECT) |
|  AccFc<sup>+</sup>Gc  | SELECT AGG(*concept*), *concept* FROM event\_log WHERE (FILTER *concept*)<sup>+</sup> GROUP BY *concept* |
|  SIE | (SELECT) (INTERSECT \| EXCEPT) (SELECT) ((INTERSECT \| EXCEPT) SELECT)<sup>*</sup> |

**Exact Match Accuracy**

*English*
![My Image](graphs_results/results_hard_EM.png)

*Portuguese*
![My Image](graphs_results/results_hard_EM_pt.png)

**Execution Accuracy**

*English*
![My Image](graphs_results/results_hard_EX.png)

*Portuguese*
![My Image](graphs_results/results_hard_EX_pt.png)

### Extra
|  Symbol   |                                           SQL Pattern                                                       |
|-----------|-------------------------------------------------------------------------------------------------------------|
|  ScFc<sup>+</sup>(Gc)<sup>*</sup> | SELECT (*concept*) FROM event\_log WHERE (FILTER *concept*)<sup>+</sup> (GROUP BY *concept*)<sup>* </sup> (ORDER BY *concept*)<sup>*</sup> |
|  ScFSc(Fc)<sup>* </sup>(Gc)<sup>*</sup> | SELECT *concept* FROM event\_log WHERE (FILTER *concept* SELECT) (FILTER *concept*)<sup>* </sup> (GROUP BY *concept*)<sup>* </sup> (ORDER BY *concept*)<sup>*</sup> |
|  Sc(Fc)<sup>*</sup>GcFSc | SELECT *concept* FROM event\_log (WHERE FILTER *concept*)<sup>* </sup> GROUP BY *concept* HAVING (FILTER *concept* SELECT) (ORDER BY *concept*)<sup>*</sup> |
|  Acc<sup>+</sup>Fc<sup>+</sup>Gc<sup>+</sup> | SELECT AGG(*concept*), *concept*<sup>+</sup> FROM event\_log WHERE (FILTER *concept*)<sup>+</sup> GROUP BY *concept*<sup>+</sup> |
|  AcFSc | SELECT AGG(*concept*) FROM event\_log WHERE (FILTER *concept* SELECT) |
|  AccGc(FSc)<sup>*</sup> | SELECT AGG(*concept*), *concept* FROM event\_log GROUP BY *concept* (HAVING FILTER *concept* SELECT)<sup>* </sup> (ORDER BY *concept*)<sup>*</sup> |
|  SU | (SELECT) (UNION) (SELECT) |

**Exact Match Accuracy**

*English*
![My Image](graphs_results/results_extra_EM.png)

*Portuguese*
![My Image](graphs_results/results_extra_EM_pt.png)

**Execution Accuracy**

*English*
![My Image](graphs_results/results_extra_EX.png)

*Portuguese*
![My Image](graphs_results/results_extra_EX_pt.png)


### No hardness
|  Symbol   |                                           SQL Pattern                                                       |
|-----------|-------------------------------------------------------------------------------------------------------------|
|  Sc<sup>+</sup>Fc<sup>+</sup>(Gc)<sup>*</sup> | SELECT (*concept*<sup>+</sup>) FROM event\_log (INNER JOIN event\_log)<sup>* </sup> WHERE (FILTER *concept*)<sup>+</sup> (GROUP BY *concept*)<sup>*</sup> |
|  Sc<sup>+</sup>Gc(Fc)<sup>*</sup> | SELECT (*concept*<sup>+</sup>) FROM event\_log GROUP BY *concept* (HAVING FILTER *concept*)<sup>*</sup> |
|  Sc<sup>+</sup>(Fc)<sup>* </sup>FSc(Gc)<sup>*</sup> | SELECT (*concept*<sup>+</sup>) FROM event\_log WHERE (FILTER *concept*)<sup>* </sup> (FILTER *concept* SELECT) (GROUP BY *concept*)<sup>*</sup> |
|  Sc<sup>+</sup>RS(Fc)<sup>*</sup> | SELECT (*concept*<sup>+</sup>) FROM (event\_log \| SELECT) (JOIN SELECT)<sup>* </sup> WHERE (FILTER *concept*)<sup>* </sup> (ORDER BY *concept*)<sup>*</sup> |
|  Ac(c)<sup>* </sup>Fc<sup>+</sup>(Gc)<sup>*</sup> | SELECT AGG(*concept*), (*concept*)<sup>* </sup> FROM event\_log (INNER JOIN event\_log)<sup>* </sup> WHERE (FILTER *concept*)<sup>+</sup> (GROUP BY *concept*)<sup>*</sup> |
|  AccFScGc | SELECT AGG(*concept*), *concept* FROM event\_log WHERE (FILTER *concept* SELECT) (GROUP BY *concept*) |
|  AccGc | SELECT AGG(*concept*), *concept* FROM event\_log GROUP BY *concept* |
|  Ac(c)<sup>* </sup>RS(Fc)<sup>* </sup>(Gc)<sup>*</sup> | SELECT AGG(*concept*), (*concept*)<sup>* </sup> FROM (event\_log \| SELECT) (JOIN SELECT)<sup>* </sup> WHERE (FILTER *concept*)<sup>* </sup> (GROUP BY *concept*)<sup>*</sup> |
|  S(UE)<sup>+</sup> | SELECT ((UNION\|EXCEPT) SELECT)<sup>+</sup> |
|  WS | WITH (SELECT)<sup>+</sup> SELECT | 


**Exact Match Accuracy**

*English*
![My Image](graphs_results/results_no_hardness_EM.png)

*Portuguese*
![My Image](graphs_results/results_no_hardness_EM_pt.png)

**Execution Accuracy**

*English*
![My Image](graphs_results/results_no_hardness_EX.png)

*Portuguese*
![My Image](graphs_results/results_no_hardness_EX_pt.png)




